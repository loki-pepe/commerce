{% extends "auctions/layout.html" %}

{% block body %}
    <div>
        {{ listing.time }}
    </div>
    {% if not listing.active_status %}
        <div>
            This listing is no longer active.
        </div>
    {% endif %}
    {% if user.is_authenticated %}
        {% if user == listing.buyer %}
            <div>
                You have won the auction.
            </div>
        {% endif %}
        <div>
            <form action="{% url 'listing' listing.id %}" method="post">
                {% csrf_token %}
                {% if watchlist %}
                    <button type="submit" name="w_list" value="remove">Remove from watchlist</button>
                {% else %}
                    <button type="submit" name="w_list" value="add">Add to watchlist</button>
                {% endif %}
            </form>
        </div>
    {% endif %}
    <div>
        <h3>{{ listing.title }}</h3>
    </div>
    <div>
        Category: <a href="{% url 'categories' %}?c={{ listing.get_category_display }}">{{ listing.get_category_display }}</a>
    </div>
    <div>
        {% if listing.image %}
            <img src="{{ listing.image }}">
        {% else %}
            <img src="https://upload.wikimedia.org/wikipedia/commons/1/14/No_Image_Available.jpg?20200913095930">
        {% endif %}
    </div>
    <div>
        {{ listing.description}}
    </div>
    <div>
        {% if bid %}
            {% if listing.active_status %}
                Current bid: ${{ bid.amount }}
            {% else %}
                <div>
                    Winning bid: ${{ bid.amount }}
                </div>
                <div>
                    {% if listing.buyer == user %}
                        by <strong>you</strong>
                    {% else %}
                        by <strong>{{ listing.buyer }}</strong>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            Starting price: ${{ listing.start_price }}
        {% endif %}
    </div>
    {% if user.is_authenticated and listing.active_status %}
    <div>
        {% if not user == listing.seller %}
            <div>
                Make a bid:
            </div>
            <div>
                <form action="{% url 'listing' listing.id %}" method="post">
                    {% csrf_token %}
                    {% if bid %}
                        <input type="number" min="{{ bid.amount }}" step="0.01" name="bd">
                    {% else %}
                        <input type="number" min="{{ listing.start_price }}" step="0.01" name="bd">
                    {% endif %}
                    <button type="submit">Bid</button>
                </form>
            </div>
        {% else %}
            <div>
                <form action="{% url 'listing' listing.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" name="close" value="close">Close the listing</button>
                </form>
            </div>
        {% endif %}
    </div>
    {% endif %}
    <div id="comments">
        <hr>
        <div>
            <h3>
                Comments
            </h3>
        </div>
        {% if comments %}
            <div>
                {% for comment in comments %}
                    <div>
                        <strong>{{ comment.commenter }}</strong>
                    </div>
                    <div>
                        {{ comment.text }}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div>
                No comments.
            </div>
        {% endif %}
        {% if user.is_authenticated and listing.active_status %}
            <div>
                <form action="{% url 'listing' listing.id %}" method="post">
                    {% csrf_token %}
                    <div>
                        <textarea name="cmnt" placeholder="Comment"></textarea>
                    </div>
                    <div>
                        <button type="submit">Post</button>
                    </div>
                </form>
            </div>
        {% endif %}
    </div>
{% endblock %}