{% extends "auctions/layout.html" %}

{% block body %}
    {% if category %}
        <h2>{{ category }}</h2>
    {% else %}
        <h2>Active Listings</h2>
    {% endif %}

    <ul>
        {% if listings %}
            {% for listing in listings %}
                <li>
                    <div>
                        <h4><a href="{% url 'listing' listing.id %}">{{ listing.title }}</a></h4>
                    </div>
                    <div>
                        {% if listing.image %}
                            <img src="{{ listing.image }}">
                        {% else %}
                            <img src="https://upload.wikimedia.org/wikipedia/commons/1/14/No_Image_Available.jpg?20200913095930">
                        {% endif %}
                    </div>
                    <div>
                        {{ listing.description }}
                    </div>
                    <div>
                        Category: <a href="{% url 'categories' %}?c={{ listing.get_category_display }}">{{ listing.get_category_display }}</a>
                        {% for bid in listing.bids.all %}
                            {% if bid.highest_bid %}
                                {% if listing.active_status %}
                                    <h4>Current bid: ${{ bid.amount }}</h4>
                                {% else %}
                                    <h4>Sold for ${{ bid.amount }}</h4>
                                {% endif %}
                            {% endif %}
                        {% empty %}
                            {% if listing.active_status %}
                                <h4>Starting price: ${{ listing.start_price }}</h4>
                            {% else %}
                                <h4>Closed</h4>
                            {% endif %}
                        {% endfor %}
                    </div>
                </li>
            {% endfor %}
        {% else %}
            No listings.
        {% endif %}
    </ul>
{% endblock %}